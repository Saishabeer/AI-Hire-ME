{% extends 'base.html' %}
{% load static %}
{% block title %}{{ interview.title }} â€” Live AI Interview{% endblock %}

{% block content %}
<div
  id="ai-interview-root"
  data-session-url="{% url 'interviews:ai_interview_realtime_session' %}"
  data-interview-id="{{ interview.id }}"
  data-submit-url="{{ submit_url }}"
  data-responses-url="{% if request.user.is_authenticated and request.user == interview.created_by or request.user.is_staff or request.user.is_superuser %}{% url 'interviews:responses' interview.pk %}{% else %}{% url 'interviews:detail' interview.pk %}{% endif %}"
  data-candidate-name="{{ candidate_name|default_if_none:'' }}"
  data-candidate-email="{{ candidate_email|default_if_none:'' }}"
  style="display:none"
></div>
<div class="container page">
  <!-- Header -->
  <div class="card">
    <h1 class="text-2xl font-bold mb-1">
      <i class="fas fa-robot mr-2"></i>{{ interview.title }}
    </h1>
    {% if interview.description %}
      <p class="text-gray-600">{{ interview.description }}</p>
    {% endif %}
  </div>

  <!-- Section tabs / stepper -->
  <div class="card">
    <div id="section-tabs" class="stepper">
      {% for s in sections %}
      <div class="step-item section-tab" id="tab-{{ s.id }}" data-section-id="{{ s.id }}" data-answered="0" data-total="{{ s.questions.all|length }}">
        <div class="dot"></div>
        <div class="label">{{ s.title }}</div>
        <div class="count text-xs"><span class="answered">0</span>/<span class="total">{{ s.questions.all|length }}</span> answered</div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Two-panel layout -->
  <div class="grid grid-2">
    <!-- Collected info (left) -->
    <div class="card" id="collected-card">
      <div class="text-sm text-gray-400 uppercase tracking-wide">Collected Information</div>
      <div class="text-xs text-gray-500 mb-4">Form details and progress</div>
      <div id="collected-info" class="space-y-6">
        {% for s in sections %}
        <div class="section-block">
          <h3 class="text-lg font-bold mb-3">{{ s.title }}</h3>
          <div class="space-y-3">
            {% for q in s.questions.all %}
            <div class="qa" data-question-id="{{ q.id }}" data-section-id="{{ s.id }}">
              <div class="bubble bubble-q">{{ q.question_text }}</div>
              <div class="bubble bubble-a answer" id="ans-{{ q.id }}"></div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Voice chat (right) -->
    <div class="card" id="voice-card">
      <div class="text-sm text-gray-400 uppercase tracking-wide">Voice Chat</div>
      <div class="text-xs text-gray-500 mb-4">Real-time conversation</div>
      <div id="transcript" class="chat-box">
        <div id="transcript-list"></div>
      </div>
      <div class="btn-row mt-4">
        <button id="connect-interview" class="btn btn-success"><i class="fas fa-play"></i> Connect</button>
        <button id="pause-interview" class="btn btn-warning" disabled><i class="fas fa-pause"></i> Pause</button>
        <button id="end-interview" class="btn btn-danger" disabled><i class="fas fa-stop"></i> End</button>
        <span id="status-pill" class="pill pill-red">Disconnected</span>
        <a href="{% url 'interviews:detail' interview.pk %}" class="btn btn-outline">
          <i class="fas fa-arrow-left"></i> Back
        </a>
      </div>
    </div>
  </div>


  <audio id="ai-remote-audio" autoplay playsinline></audio>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/ai_interview.js' %}"></script>
{% endblock %}
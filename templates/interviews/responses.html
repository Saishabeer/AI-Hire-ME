{% extends 'base.html' %}

{% block title %}Responses: {{ interview.title }} - AI Interviewer{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="card">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">
            <i class="fas fa-chart-bar text-purple-600 mr-2"></i>Interview Responses
        </h1>
        <p class="text-gray-600">{{ interview.title }}</p>
        <div class="mt-4 flex items-center space-x-6 text-sm text-gray-700">
            <span><i class="fas fa-users mr-2"></i>{{ responses.count }} responses</span>
            <span><i class="fas fa-question-circle mr-2"></i>{{ interview.questions.count }} questions</span>
        </div>
    </div>

    <!-- Responses -->
    {% if responses %}
    <div class="space-y-4">
        {% for response in responses %}
        <div class="card">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h3 class="text-xl font-bold text-gray-900">{{ response.candidate.full_name|default:"Unknown" }}</h3>
                    <p class="text-gray-600">{{ response.candidate.email|default:"" }}</p>
                </div>
                <span class="text-sm text-gray-500">
                    <i class="fas fa-clock mr-1"></i>{{ response.submitted_at|date:"M d, Y H:i" }}
                </span>
            </div>

            <div class="space-y-4">
                {% if response.answers.all %}
                    {% for answer in response.answers.all %}
                    <div class="border-l-4 border-purple-300 pl-4">
                        <p class="font-medium text-gray-900 mb-2">{{ answer.question.question_text }}</p>
                        {% if answer.answer_text %}
                            <p class="text-gray-700">{{ answer.answer_text }}</p>
                        {% elif answer.selected_options %}
                            <ul class="list-disc list-inside text-gray-700">
                                {% for opt in answer.selected_options %}
                                <li>{{ opt }}</li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="text-gray-400 italic">No answer provided</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% elif response.answers_transcript.answers %}
                    {% for item in response.answers_transcript.answers %}
                    <div class="border-l-4 border-purple-300 pl-4">
                        <p class="font-medium text-gray-900 mb-2">{{ item.question_text }}</p>
                        {% if item.text %}
                            <p class="text-gray-700">{{ item.text }}</p>
                        {% elif item.option_values %}
                            <ul class="list-disc list-inside text-gray-700">
                                {% for opt in item.option_values %}
                                <li>{{ opt }}</li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="text-gray-400 italic">No answer provided</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="text-gray-400 italic">No answers recorded</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card text-center">
        <i class="fas fa-inbox text-gray-400 text-6xl mb-4"></i>
        <h3 class="text-xl font-bold text-gray-900 mb-2">No responses yet</h3>
        <p class="text-gray-600 mb-6">Share your interview link with candidates to collect responses</p>
        <code class="bg-gray-100 px-4 py-2 rounded text-sm">
            http://localhost:8000{% url 'interviews:take' interview.pk %}
        </code>
    </div>
    {% endif %}

    <!-- Back Button -->
    <div>
        <a href="{% url 'interviews:edit' interview.pk %}" class="btn btn-outline">
            <i class="fas fa-arrow-left mr-2"></i>Back to Edit
        </a>
    </div>
</div>
{% endblock %}
